
## Load remediation script to fix failed controls of Azure Tenant Security Solution - Step by Step

In this section, we will walk through the steps of loading remediation script.

  

**Note:** You can download remediation script present [here](../../TemplateFiles/RemediationScripts.zip?raw=1)

  

Loading script in PowerShell session is divided into four steps:

  

### **Step 1 of 4. Validate prerequisites on machine**

  

i) Installation steps are supported using following OS options:

  

- Windows 10

- Windows Server 2019

  

ii) PowerShell 5.0 or higher:

  

All setup steps will be performed with the help of PowerShell ISE console. If you are unaware of PowerShell ISE, refer [link](https://github.com/azsk/DevOpsKit-docs/blob/master/00b-Getting-Started/GettingStarted_PowerShellTipsAzSK.md) to get basic understanding.

Ensure that you are using Windows OS and have PowerShell version 5.0 or higher by typing **$PSVersionTable** in the PowerShell ISE console window and looking at the PSVersion in the output as shown below.)

If the PSVersion is older than 5.0, update PowerShell from [here](https://www.microsoft.com/en-us/download/details.aspx?id=54616).

  

![PowerShell Version](../../Images/00_PS_Version.png)

  

### **Step 2 of 4. Installing Az Modules:**

  

Az modules contain cmdlet to connect to az account.

Install Az PowerShell Modules using below command.

For more details of Az Modules refer [link](https://docs.microsoft.com/en-us/powershell/azure/install-az-ps)

  

``` PowerShell

# Install Az Modules

Install-Module -Name Az.Accounts -AllowClobber -Scope CurrentUser -repository PSGallery

```

### **Step 3 of 4. Download and extract remediation package**

Remediation package mainly contains:

1.  **RemediationScripts** which contains powershell scripts to remediate AzTS controls.

  

If you have already downloaded the remediation package zip, you can start from step (3.d).

  

3.a. Download remediation package zip from [here](../../TemplateFiles/RemediationScripts.zip?raw=1) to your local machine. </br>

  

3.b. Extract zip to local folder location. <br/>

  

3.c. Unblock the content. The below command will help to unblock files. <br/>

  

``` PowerShell

Get-ChildItem -Path "<Extracted folder path>" -Recurse | Unblock-File

```

  

3.d. Point current path to downloaded script folder location and load remediation script in PowerShell session

``` PowerShell

# Point current path to location where script is downloaded and load script from folder

  

CD "<LocalExtractedFolderPath>"

  

# Before loading remediation script in current session, please connect to AzAccount

Connect-AzAccount

  

# Load remediation script in session

. ".\<RemediationScriptFileName>.ps1"

  

# Note: Make sure you copy '.' present at the start of line.

```

  

**Step 4 of 4. Execute remediation scripts:**

  

After completing above mentioned steps, open remediation script in PowerShell and follow instructions as per comments present in each script.## Load remediation script to fix failed controls of Azure Tenant Security Solution - Step by Step

In this section, we will walk through the steps of loading remediation script.

  

**Note:** You can download remediation script present [here](../../TemplateFiles/RemediationScripts.zip?raw=1)

  

Loading script in PowerShell session is divided into four steps:

  

### **Step 1 of 4. Validate prerequisites on machine**

  

i) Installation steps are supported using following OS options:

  

- Windows 10

- Windows Server 2019

  

ii) PowerShell 5.0 or higher:

  

All setup steps will be performed with the help of PowerShell ISE console. If you are unaware of PowerShell ISE, refer [link](https://github.com/azsk/DevOpsKit-docs/blob/master/00b-Getting-Started/GettingStarted_PowerShellTipsAzSK.md) to get basic understanding.

Ensure that you are using Windows OS and have PowerShell version 5.0 or higher by typing **$PSVersionTable** in the PowerShell ISE console window and looking at the PSVersion in the output as shown below.)

If the PSVersion is older than 5.0, update PowerShell from [here](https://www.microsoft.com/en-us/download/details.aspx?id=54616).

  

![PowerShell Version](../../Images/00_PS_Version.png)

  

### **Step 2 of 4. Installing Az Modules:**

  

Az modules contain cmdlet to connect to az account.

Install Az PowerShell Modules using below command.

For more details of Az Modules refer [link](https://docs.microsoft.com/en-us/powershell/azure/install-az-ps)

  

``` PowerShell

# Install Az Modules

Install-Module -Name Az.Accounts -AllowClobber -Scope CurrentUser -repository PSGallery

```

### **Step 3 of 4. Download and extract remediation package**

Remediation package mainly contains:

1.  **RemediationScripts** which contains powershell scripts to remediate AzTS controls.

  

If you have already downloaded the remediation package zip, you can start from step (3.d).

  

3.a. Download remediation package zip from [here](../../TemplateFiles/RemediationScripts.zip?raw=1) to your local machine. </br>

  

3.b. Extract zip to local folder location. <br/>

  

3.c. Unblock the content. The below command will help to unblock files. <br/>

  

``` PowerShell

Get-ChildItem -Path "<Extracted folder path>" -Recurse | Unblock-File

```

  

3.d. Point current path to downloaded script folder location and load remediation script in PowerShell session

``` PowerShell

# Point current path to location where script is downloaded and load script from folder

  

CD "<LocalExtractedFolderPath>"

  

# Before loading remediation script in current session, please connect to AzAccount

Connect-AzAccount

  

# Load remediation script in session

. ".\<RemediationScriptFileName>.ps1"

  

# Note: Make sure you copy '.' present at the start of line.

```

  

**Step 4 of 4. Execute remediation scripts:**

  

After completing above mentioned steps, open remediation script in PowerShell and follow instructions as per comments present in each script.## Load remediation script to fix failed controls of Azure Tenant Security Solution - Step by Step

In this section, we will walk through the steps of loading remediation script.

  

**Note:** You can download remediation script present [here](../../TemplateFiles/RemediationScripts.zip?raw=1)

  

Loading script in PowerShell session is divided into four steps:

  

### **Step 1 of 4. Validate prerequisites on machine**

  

i) Installation steps are supported using following OS options:

  

- Windows 10

- Windows Server 2019

  

ii) PowerShell 5.0 or higher:

  

All setup steps will be performed with the help of PowerShell ISE console. If you are unaware of PowerShell ISE, refer [link](https://github.com/azsk/DevOpsKit-docs/blob/master/00b-Getting-Started/GettingStarted_PowerShellTipsAzSK.md) to get basic understanding.

Ensure that you are using Windows OS and have PowerShell version 5.0 or higher by typing **$PSVersionTable** in the PowerShell ISE console window and looking at the PSVersion in the output as shown below.)

If the PSVersion is older than 5.0, update PowerShell from [here](https://www.microsoft.com/en-us/download/details.aspx?id=54616).

  

![PowerShell Version](../../Images/00_PS_Version.png)

  

### **Step 2 of 4. Installing Az Modules:**

  

Az modules contain cmdlet to connect to az account.

Install Az PowerShell Modules using below command.

For more details of Az Modules refer [link](https://docs.microsoft.com/en-us/powershell/azure/install-az-ps)

  

``` PowerShell

# Install Az Modules

Install-Module -Name Az.Accounts -AllowClobber -Scope CurrentUser -repository PSGallery

```

### **Step 3 of 4. Download and extract remediation package**

Remediation package mainly contains:

1.  **RemediationScripts** which contains powershell scripts to remediate AzTS controls.

  

If you have already downloaded the remediation package zip, you can start from step (3.d).

  

3.a. Download remediation package zip from [here](../../TemplateFiles/RemediationScripts.zip?raw=1) to your local machine. </br>

  

3.b. Extract zip to local folder location. <br/>

  

3.c. Unblock the content. The below command will help to unblock files. <br/>

  

``` PowerShell

Get-ChildItem -Path "<Extracted folder path>" -Recurse | Unblock-File

```

  

3.d. Point current path to downloaded script folder location and load remediation script in PowerShell session

``` PowerShell

# Point current path to location where script is downloaded and load script from folder

  

CD "<LocalExtractedFolderPath>"

  

# Before loading remediation script in current session, please connect to AzAccount

Connect-AzAccount

  

# Load remediation script in session

. ".\<RemediationScriptFileName>.ps1"

  

# Note: Make sure you copy '.' present at the start of line.

```

  

**Step 4 of 4. Execute remediation scripts:**

  

After completing above mentioned steps, open remediation script in PowerShell and follow instructions as per comments present in each script.

## Recommendations for controls

| ControlID                                                                  | Display Name                                                                                                                           | Recommendations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| -------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Azure\_APIManagement\_DP\_Use\_HTTPS\_URL\_Scheme                          | Backend API(s) must be accessible only over HTTPS via API Management service                                                           | Run command: Set-AzApiManagementApi -Context {APIContextObject} -Protocols 'Https' -Name '{APIName}' -ApiId '{APIId}' -ServiceUrl '{ServiceURL}'. Run command : Get-AzApiManagementApi -Context '{APIContextObject}' to get the details of existing APIs. Refer https://docs.microsoft.com/en-us/powershell/module/az.apimanagement/set-azapimanagementapi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Azure\_APIManagement\_DP\_Use\_Secure\_TLS\_Version                        | Latest TLS version should be used in your APIM                                                                                         | Ensure that secure protocol versions are used between the client and the gateway \*and\* between the gateway and the backend APIs. Go to Azure Portal --> your API management instance --> Settings --> Protocol settings --> Turn OFF 3DES Ciphers, TLS protocols (1.1 and 1.0) and SSL 3.0 Protocols.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Azure\_APIManagement\_DP\_Remove\_Default\_Products                        | Delete the two sample products 'Starter' and 'Unlimited' to avoid accidental exposure of APIs                                          | To delete sample products go to Azure Portal --> your API management instance --> Products --> Select 'Starter'/'Unlimited' Product --> Delete.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_APIManagement\_AuthN\_Verify\_Delegated\_Authentication             | Delegated authentication should be implemented securely                                                                                | To disable delegation, go to APIM service --> Developer portal --> Delegation --> Uncheck the two check boxes (a) Delegate sign-in & sign-up (b) Delegate product subscription. Read more about delegation here https://docs.microsoft.com/en-us/azure/api-management/api-management-howto-setup-delegation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_APIManagement\_AuthZ\_Validate\_JWT                                 | Ensure that JWT validation is enabled if using OAuth 2.0 or OpenID connect                                                             | For steps to add JWT Validate Token policy please refer: https://docs.microsoft.com/en-us/azure/api-management/api-management-access-restriction-policies#ValidateJWT and https://docs.microsoft.com/en-us/azure/api-management/api-management-howto-protect-backend-with-aad#configure-a-jwt-validation-policy-to-pre-authorize-requests                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Azure\_APIManagement\_AuthN\_Disable\_Management\_API                      | Do not use API Management REST API                                                                                                     | To disable API Management REST API, go to APIM service --> Deployment and infrastructure --> Management API --> Enable Management REST API --> No. For better security it is recommended to make calls through the ARM based REST API mentioned in https://docs.microsoft.com/en-us/rest/api/apimanagement.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_APIManagement\_AuthZ\_Enable\_User\_Authorization\_For\_API         | Ensure that either OAuth 2.0 or OpenID Connect are used to authorize developer accounts in API Management                              | To enable user authorization for an API go to Azure Portal --> your API management instance --> APIs --> Select API --> Settings -> User Authorization -> Enable 'OAuth 2.0' or 'OpenID connect'. Please refer https://docs.microsoft.com/en-us/azure/api-management/api-management-howto-oauth2.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Azure\_APIManagement\_AuthN\_Use\_AAD\_for\_Client\_AuthN                  | Enterprise applications using APIM must authenticate developers/applications using Azure Active Directory backed credentials           | For steps to use Azure Active Directory (Azure AD) please refer https://docs.microsoft.com/en-us/azure/api-management/api-management-howto-aad.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_APIManagement\_AuthN\_Secure\_API\_Using\_Client\_Certificates      | Use client certificates for authentication between gateway and backend APIs                                                            | To enable client certificate authentication from Azure portal please refer https://docs.microsoft.com/en-us/azure/api-management/api-management-howto-mutual-certificates and https://docs.microsoft.com/en-us/azure/api-management/api-management-authentication-policies.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_APIManagement\_AuthZ\_Enable\_Requires\_Subscription                | 'Requires Subscription' option must be turned on for all products in an API Management instance                                        | To enable 'Requires Subscription' go to Azure Portal --> your API management instance --> Products --> Settings --> 'Requires Subscription'. Refer: https://docs.microsoft.com/en-us/azure/api-management/api-management-subscriptions. To create subscription for a user directly from Azure portal refer https://docs.microsoft.com/en-us/azure/api-management/api-management-howto-create-subscriptions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Azure\_APIManagement\_AuthN\_Use\_Managed\_Service\_Identity               | Use Managed Service Identity (MSI) for accessing other AAD-protected resources from the API management instance                        | Go to Azure Portal --> your API management instance --> Settings --> Managed Service Identity --> Register with AAD --> ON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Azure\_AppService\_DP\_Use\_CNAME\_With\_SSL                               | Custom domain with SSL binding must be configured for App Service                                                                      | Go to Azure Portal --> your App Service --> Settings --> Custom Domains and follow the steps mentioned to configure a custom domain. Run command 'New-AzWebAppSSLBinding' to enable the SSL binding for your custom domain. Run 'Get-Help New-AzWebAppSSLBinding -full' for more help.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Azure\_AppService\_Config\_Disable\_Remote\_Debugging                      | Remote debugging should be turned off for Web Applications                                                                             | To disable remote debugging on default 'Production' slot: Go to Azure Portal --> your App Service --> Settings --> Configuration --> General Settings --> Remote Debugging --> Click on 'OFF'. To disable remote debugging on any non-production slot: Go to Azure Portal --> your App Service --> Deployment --> Deployment slots --> Select slot --> Settings --> Configuration --> General Settings --> Remote Debugging --> Click on 'OFF'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_AppService\_Config\_Disable\_Web\_Sockets                           | Web Sockets should be disabled for App Service                                                                                         | To disable Web Sockets on default 'Production' slot: Run command 'Set-AzWebApp -Name '<WebAppName>' -ResourceGroupName '<RGName>' -WebSocketsEnabled \`$false'. Run 'Get-Help Set-AzWebApp -full' for more help. To disable Web Sockets on any non-production slot: Run command 'Set-AzWebAppSlot -ResourceGroupName '<RGName>' -Name '<WebAppName>' -Slot '<SlotName>' -WebSocketsEnabled \`$false' Refer: https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/HTML5\_Security\_Cheat\_Sheet.md#websockets                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Azure\_AppService\_BCDR\_Use\_AlwaysOn                                     | 'Always On' should be configured for App Service                                                                                       | Go to Azure Portal --> your App Service --> Settings --> Configuration --> General Settings --> Always On --> Click on 'ON'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Azure\_AppService\_BCDR\_Use\_Multiple\_Instances                          | App Service must be deployed on a minimum of two instances to ensure availability                                                      | Run command 'Set-AzAppServicePlan -Name '<AppServicePlanName>' -ResourceGroupName '<RGName>' -NumberofWorkers '<NumberofInstances>''. Run 'Get-Help Set-AzAppServicePlan -full' for more help.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_AppService\_Audit\_Enable\_Logging\_and\_Monitoring                 | Monitoring must be enabled for App Service                                                                                             | To enable monitoring on default 'Production' slot: Run command 'Set-AzWebApp -Name '<WebAppName>' -ResourceGroupName '<RGName>' -DetailedErrorLoggingEnabled \`$true -HttpLoggingEnabled \`$true -RequestTracingEnabled \`$true'. Run 'Get-Help Set-AzWebApp -full' for more help. To enable monitoring on any non-production slot: Run command 'Set-AzWebAppSlot -ResourceGroupName '<RGName>' -Name '<WebAppName>' -Slot '<SlotName>' -DetailedErrorLoggingEnabled \`$true -HttpLoggingEnabled \`$true -RequestTracingEnabled \`$true'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Azure\_AppService\_DP\_Dont\_Allow\_HTTP\_Access                           | Use HTTPS for app services                                                                                                             | To enable only https traffic on default 'Production' slot:Run command 'Set-AzWebApp -Name '<WebAppName>' -ResourceGroupName '<RGName>' -HttpsOnly \`$true'. Run 'Get-Help Set-AzWebApp -full' for more help. To enable only https traffic on any non-production slot: Run command 'Set-AzWebAppSlot -ResourceGroupName '<RGName>' -Name '<WebAppName>' -Slot '<SlotName>' -HttpsOnly \`$true'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Azure\_AppService\_DP\_Use\_Secure\_TLS\_Version                           | Use Approved TLS Version in App Service                                                                                                | To set required TLS version on default 'Production' slot: Go to Azure Portal --> your App Service --> Settings --> TLS/SSL --> Minimum TLS version --> set to org approved version (see status reason). To set required TLS version on any non-production slot: Go to Azure Portal --> your App Service --> Deployment --> Deployment slots --> Select slot --> Settings --> TLS/SSL --> Minimum TLS version --> set to org approved version (see status reason).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Azure\_AppService\_AuthZ\_Configure\_IP\_Restrictions                      | Setup IP-based access restrictions for App Service if feasible                                                                         | Consider using IP-based access restrictions for App Service if feasible. Steps: Go to Azure Portal --> your App Service --> Networking --> Access Restrictions --> Configure Access Restrictions --> Add/Verify access restriction rule for app and scm site. For more information, refer: https://docs.microsoft.com/en-us/azure/app-service/app-service-ip-restrictions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Azure\_AppService\_DP\_Review\_CORS\_Request\_Credential                   | Review use of credentials in CORS request for App Service                                                                              | Go to Azure Portal --> your App Service --> API --> CORS --> Request Credentials --> Review if you need to enable 'Access-Control-Allow-Credentials'. Note: No action is needed if you are not using CORS for your app.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Azure\_CDN\_DP\_Enable\_Https                                              | CDN endpoints must use HTTPS protocol while providing data to the client browser/machine or while fetching data from the origin server | Enable only HTTPs protocol for endpoints, to enable HTTPS protocol: Go to Azure Portal --> your CDN Profile --> your CDN Endpoint --> Origin --> Select HTTPS --> Save. Else implement through PowerShell as follows: \`$ce= Get-AzCdnEndpoint -EndpointName <EndpointName> -ProfileName <CDNprofile> -ResourceGroupName <RGName>; \`$ce.IsHttpAllowed =\`$false; \`$ce.IsHttpsAllowed =\`$true; Set-AzCdnEndpoint -CdnEndpoint \`$ce. Note: In the interest of user experience, enable both HTTP and HTTPS protocol along with HTTP to HTTPS redirection rule configured in rules engine for all endpoints, to enable HTTP and HTTPS protocol: Go to Azure Portal --> your CDN Profile --> your CDN Endpoint --> Origin --> Select HTTPS and HTTP --> Save. Else implement through PowerShell as follows: \`$ce= Get-AzCdnEndpoint -EndpointName <EndpointName> -ProfileName <CDNprofile> -ResourceGroupName <RGName>; \`$ce.IsHttpAllowed =\`$true; \`$ce.IsHttpsAllowed =\`$true; Set-AzCdnEndpoint -CdnEndpoint \`$ce and refer: https://docs.microsoft.com/en-us/azure/cdn/cdn-standard-rules-engine to configure HTTP to HTTPs redirection rule in rules engine. |
| Azure\_CloudService\_DP\_DontAllow\_HTTP\_Access\_InputEndpoints           | Encrypt data in transit for Cloud service role                                                                                         | Get an SSL certificate from a trusted certificate provider. Upload that certificate to cloud service. Update input endpoints by renaming HTTP to HTTPS in .csdef. Refer: https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-configure-ssl-certificate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Azure\_CloudService\_SI\_Auto\_OSUpdate                                    | Set automatic update for Cloud Service OS version                                                                                      | To enable automatic updates: Go to manage Azure portal --> your cloud service --> under configure tab --> set operating system version to automatic.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Azure\_CloudService\_SI\_Enable\_AntiMalware                               | Antimalware extension must be installed on cloud service roles                                                                         | To enable Antimalware: Go to Azure portal --> your cloud service --> Antimalware under Settings section--> select role and enable Antimalware.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_CloudService\_SI\_Disable\_RemoteDesktop\_Access                    | Disable Remote Desktop (RDP) access on cloud service roles                                                                             | From Azure Portal: After logging into subscription, go under Home -> All Resources -> Select the Cloud service resource type -> Remote Desktop. Under "Remote Desktop", make sure to select "Disabled" toggle option. From PowerShell: Refer https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-role-enable-remote-desktop-powershell to remove Remote Desktop Extension from a Service. Refer https://docs.microsoft.com/en-us/powershell/module/servicemanagement/azure.service/remove-azureserviceremotedesktopextension?view=azuresmps-4.0.0 to know more about Remove-AzureServiceRemoteDesktopExtension command.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Azure\_CloudService\_SI\_Disable\_RemoteDesktop\_Access\_Trial             | \[Trial\] Disable Remote Desktop (RDP) access on cloud service roles                                                                   | From Azure Portal: After logging into subscription, go under Home -> All Resources -> Select the Cloud service resource type -> Remote Desktop. Under "Remote Desktop", make sure to select "Disabled" toggle option. From PowerShell: Refer https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-role-enable-remote-desktop-powershell to remove Remote Desktop Extension from a Service. Refer https://docs.microsoft.com/en-us/powershell/module/servicemanagement/azure.service/remove-azureserviceremotedesktopextension?view=azuresmps-4.0.0 to know more about Remove-AzureServiceRemoteDesktopExtension command.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Azure\_ContainerRegistry\_AuthZ\_Disable\_Admin\_Account                   | The Admin account in Container Registry should be disabled                                                                             | Run command 'Update-AzContainerRegistry -DisableAdminUser -Name '<ContainerRegistryName>' -ResourceGroupName '<RGName>'. Run 'Get-Help Update-AzContainerRegistry -full' for more help. You can add AAD-based SPNs or user accounts to the appropriate RBAC role instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Azure\_ContainerRegistry\_DP\_Enable\_Content\_Trust                       | Content trust must be enabled for the Container Registry                                                                               | Go to Azure Portal --> your Container Registry --> Content Trust --> Enabled. This feature is currently available only in Premium SKU. After enabling Content Trust, push only trusted images in the repositories. Refer: https://aka.ms/acr/content-trust.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_ContainerRegistry\_Config\_Enable\_Security\_Scanning               | Security scanner identity must be granted access to Container Registry for image scans.                                                | Run command 'New-AzRoleAssignment -ObjectId {ObjectId} -RoleDefinitionName {RoleName} -Scope {Scope}. Run 'Get-Help New-AzRoleAssignment -full' for more help.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_CosmosDB\_AuthZ\_Enable\_Firewall                                   | Cosmos DB firewall should be enabled                                                                                                   | Azure Portal --> Resource --> Firewall. Turn 'ON' - 'Selected Networks' and provide required IP addresses and/or ranges in the IP tab and save. Note: In case the IP range is indeterminate (for instance, if the client is a PaaS endpoint), you may need to attest this control.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Azure\_CosmosDB\_AuthZ\_Verify\_IP\_Range                                  | Configure only the required IP addresses on Cosmos DB firewall                                                                         | Do not use high ranges like 0.0.0.0/0, 0.0.0.0/1, 128.0.0.0/1, etc. Maximum IPs in a range should be less that 256 and total IPs including all ranges should be less than 2048. To modify - Azure Portal --> Resource --> Firewall and Virtual networks. Turn 'ON' - 'Enable IP Access Control' and add/or remove IP addresses and/or ranges and save. Note: In case the IP range is indeterminate (for instance, if the client is a PaaS endpoint), you may need to attest this control.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Azure\_CosmosDB\_Deploy\_Use\_Replication                                  | Use global replication                                                                                                                 | Replication ensures the continuity and rapid recovery during disasters. To add - Azure Portal --> Resource -> Replicate data globally. Select a secondary read region and save. Refer: https://docs.microsoft.com/en-in/azure/cosmos-db/distribute-data-globally                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Azure\_CosmosDB\_Deploy\_Use\_Automatic\_Failover                          | Use automatic failover                                                                                                                 | Automatic failover ensures the continuity and auto recovery during disasters. To configure, you must have at least 1 secondary replica enabled. To enabled replica - Azure Portal --> Resource -> Replicate data globally. Select a secondary read region and save. To set automatic failover - Azure Portal --> Resource -> Replicate data globally --> Automatic Failover. Turn 'ON' - 'Enable Automatic Failover', set the priorities and click 'OK'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Azure\_CosmosDB\_Enable\_Adv\_Threat\_Protection                           | Enable Threat detection for CosmosDB database                                                                                          | From Azure Portal: Refer https://docs.microsoft.com/en-us/azure/cosmos-db/cosmos-db-advanced-threat-protection.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_DataLakeAnalytics\_DP\_Encrypt\_At\_Rest                            | Data Lake Analytics sensitive data must be encrypted at rest                                                                           | Default Data Lake Store Account must have encryption enabled. Refer: https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-security-overview#data-protection                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Azure\_DataLakeStore\_DP\_Encrypt\_At\_Rest                                | Data Lake Store sensitive data must be encrypted at rest                                                                               | Ensure that encryption is not disabled when creating a new Data Lake Store. Refer: https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-security-overview#data-protection. Encryption cannot be enabled after the fact for Data Lake Store.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Azure\_DBforMySQL\_NetSec\_Dont\_Allow\_Universal\_IP\_Range               | Do not use Any-to-Any IP range for Azure Database for MySQL                                                                            | Do not configure 'Any to Any' firewall IP address. Refer: https://docs.microsoft.com/en-us/azure/mysql/concepts-firewall-rules.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_DBforMySQL\_Authz\_Enable\_SSL\_Connection                          | SSL connection must be enabled for Azure Database for MySQL                                                                            | To enable SSL connection for Azure Database for MySQL server, refer https://docs.microsoft.com/en-us/azure/mysql/concepts-ssl-connection-security.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Azure\_DBforMySQL\_Audit\_Enable\_ATP                                      | Enable Threat detection for MySQL database                                                                                             | Refer: https://docs.microsoft.com/en-us/azure/mysql/concepts-data-access-and-security-threat-protection                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Azure\_DBforPostgreSQL\_AuthZ\_Enable\_SSL\_Connection                     | SSL connection must be enabled for Azure Database for PostgreSQL                                                                       | To enable SSL connection for Azure Database for PostgreSQL server, refer https://docs.microsoft.com/en-us/azure/postgresql/concepts-ssl-connection-security.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Azure\_DBforPostgreSQL\_NetSec\_Dont\_Allow\_Universal\_IP\_Range          | Do not use Any-to-Any IP range for Azure Database for PostgreSQL servers                                                               | Do not configure 'Any to Any' firewall IP address. Refer: https://docs.microsoft.com/en-us/azure/postgresql/concepts-firewall-rules.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Azure\_DBforPostgreSQL\_Audit\_Enable\_ATP                                 | Enable Threat detection for PostgreSQL                                                                                                 | Go to your Azure Database for PostgreSQL server --> Enable Advanced Threat Protection on the server --> Tick the checkbox to 'send email notification to admins and subscription owners'. Refer: https://docs.microsoft.com/en-us/azure/postgresql/howto-database-threat-protection-portal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Azure\_DBforPostgreSQL\_Audit\_Enable\_Logging\_On\_Server                 | Enable PostgreSQL server parameters log\_connections and log\_disconnections                                                           | To configure logging for your server, go to Server Parameters --> Set following log parameter: a) 'log\_connections': 'ON' b) 'log\_disconnections': 'ON' . Refer: https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_DBforPostgreSQL\_AuthN\_Enable\_Connection\_Throttling              | Ensure server parameter 'connection\_throttling' is set to 'ON'                                                                        | The 'connection\_throttling' server parameter enables temporary connection throttling per IP for too many invalid password login failures. Go to Server parameter --> Turn 'ON' connection\_throttling.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Azure\_EventHub\_AuthZ\_Dont\_Use\_Policies\_At\_Event\_Hub\_Namespace     | Event Hub clients (event senders or receivers) must not use 'namespace' level access policies                                          | Remove all the authorization rules from Event Hub namespace except RootManageSharedAccessKey using Remove-AzEventHubAuthorizationRule command. Run 'Get-Help Remove-AzEventHubAuthorizationRule -full' for more help. Use the Azure portal to configure shared access policies with appropriate claims at the specific Event Hub scope.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Azure\_EventHub\_AuthZ\_Use\_Min\_Permissions\_Access\_Policies            | Access policies must be defined with minimum required permissions to the Event Hub                                                     | Ensure that client apps use shared access policies with the least required privilege and at the Event Hub scope. For instance, if the client app is only reading events from the event hub (as opposed to sending), then the policy used must only include the 'Listen' claim. Refer: https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-authentication-and-security-model-overview                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Azure\_HDInsight\_Deploy\_Supported\_Cluster\_Version                      | HDInsight must have supported HDI cluster version                                                                                      | Refer: https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-component-versioning?#supported-hdinsight-versions https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-upgrade-cluster                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_KeyVault\_AuthZ\_Configure\_Advanced\_Access\_Policies              | Advanced access policies must be configured on a need basis                                                                            | Remove any advanced policies that are not required using the command: Remove-AzKeyVaultAccessPolicy -VaultName '{VaultName}' -ResourceGroupName '{ResourceGroupName}' -EnabledForDeployment -EnabledForTemplateDeployment -EnabledForDiskEncryption. Refer: https://docs.microsoft.com/en-us/powershell/module/az.keyvault/Remove-AzKeyVaultAccessPolicy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Azure\_KeyVault\_SI\_Enable\_SoftDelete                                    | Soft delete must be enabled to allow recovery of deleted Key Vault and any objects (keys, secrets, etc.) contained in it               | Refer: https://docs.microsoft.com/en-us/azure/key-vault/key-vault-soft-delete-powershell to enable soft delete feature on Key Vault.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Azure\_KeyVault\_Audit\_Enable\_Diagnostics\_Log                           | Diagnostics logs must be enabled with a retention period of at least 365 days                                                          | You can change the diagnostic settings from the Azure Portal by following the steps given here: https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-archive-diagnostic-logs#archive-diagnostic-logs-using-the-portal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Azure\_KubernetesService\_Deploy\_Enable\_Cluster\_RBAC                    | Cluster RBAC must be enabled in Kubernetes Service                                                                                     | RBAC flag must be enabled while creating the Kubernetes Service. Existing non-RBAC enabled Kubernetes Service clusters cannot currently be updated for RBAC use. Refer: https://docs.microsoft.com/en-us/azure/aks/concepts-identity#kubernetes-role-based-access-control-rbac.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_KubernetesService\_AuthN\_Enabled\_AAD                              | AAD should be enabled in Kubernetes Service                                                                                            | Refer: https://docs.microsoft.com/en-us/azure/aks/aad-integration to configure AAD in Kubernetes Service.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Azure\_KubernetesService\_Deploy\_Use\_Latest\_Version                     | \[Preview\]: Kubernetes Services should be upgraded to a non-vulnerable Kubernetes version                                             | Refer: https://docs.microsoft.com/en-us/azure/aks/upgrade-cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Azure\_KubernetesService\_Audit\_Enable\_Monitoring                        | Monitoring must be enabled for Azure Kubernetes Service                                                                                | Refer: https://docs.microsoft.com/en-us/azure/azure-monitor/insights/container-insights-overview.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Azure\_KubernetesService\_NetSec\_Dont\_Open\_Management\_Ports            | Do not leave management ports open on Kubernetes nodes                                                                                 | Go to Azure Portal --> VM Settings --> Networking --> Inbound security rules --> Select security rule which allows management ports (e.g. RDP-3389, WINRM-5985, SSH-22, SMB-445) --> Click 'Deny' under Action --> Click Save.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_KubernetesService\_DP\_Disable\_HTTP\_Application\_Routing          | HTTP application routing should be disabled in Kubernetes Service                                                                      | Go to Azure Portal --> your Kubernetes Service --> Settings --> Networking --> Network options --> 'Enable HTTP application routing' option --> Uncheck checkbox.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Azure\_NotificationHub\_AuthZ\_Dont\_Use\_Manage\_Access\_Permission       | Access policies on Notification Hub must not have Manage access permissions                                                            | Use 'Send' and 'Listen' manage policies as access permissions for clients and back ends. Refer: https://docs.microsoft.com/en-us/azure/notification-hubs/notification-hubs-push-notification-security                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Azure\_NSG\_NetSec\_Dont\_Open\_Restricted\_Ports                          | Do not use risky ports on firewall and NSGs                                                                                            | Go to Azure Portal --> NSG Settings --> Inbound security rules --> Select security rule which allows management ports (e.g. RDP-3389, WINRM-5985, SSH-22, SMB-445) --> Click 'Deny' under Action --> Click Save.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Azure\_NSG\_NetSec\_Dont\_Open\_InBound\_Any\_Any                          | Firewall/NSG rules must not allow unrestricted traffic (any-any rule)                                                                  | Go to Azure Portal --> NSG Settings --> Inbound security rules --> Select security rule which allows Any-Any inbound port --> Click 'Deny' under Action --> Click Save.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Azure\_RedisCache\_DP\_Use\_SSL\_Port                                      | Non-SSL port must not be enabled                                                                                                       | To disable Non-SSL port for Redis Cache, run command : Set-AzRedisCache -ResourceGroupName <String> -Name <String> -EnableNonSslPort \`$false                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Azure\_ServiceBus\_AuthZ\_Dont\_Use\_Policies\_At\_SB\_Namespace           | All authorization rules except RootManageSharedAccessKey should be removed from Service Bus namespace                                  | Remove all the authorization rules from Service Bus namespace except RootManageSharedAccessKey using Remove-AzServiceBusAuthorizationRule command. Run 'Get-Help Remove-AzServiceBusAuthorizationRule -full' for more help. Use the Azure portal to configure shared access policies with appropriate claims at the specific entity (Topic/Queue) scope.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Azure\_ServiceFabric\_AuthZ\_Security\_Mode\_Enabled                       | Service Fabric cluster security must be enabled using security mode option                                                             | A secure cluster must be created to prevent unauthorized access to management operations (e.g., deployment, upgrade or deletion of microservices). A secure cluster also provides encryption for node-to-node communication, client-to-node communication, etc. An insecure cluster is open to be connected by any anonymous user. An insecure cluster cannot be secured at a later time. For creating a secure cluster using (1) Azure Portal, refer: https://azure.microsoft.com/en-in/documentation/articles/service-fabric-cluster-creation-via-portal/#\_3-security or using (2) ARM template refer:https://azure.microsoft.com/en-in/documentation/articles/service-fabric-cluster-creation-via-arm/                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Azure\_ServiceFabric\_AuthN\_Client\_AuthN\_AAD\_Only                      | Use Azure Active directory for client authentication on Service Fabric clusters                                                        | A Service Fabric cluster offers several entry points to its management functionality, including the web-based Service Fabric Explorer, Visual Studio and PowerShell. Access to the cluster must be controlled using AAD. Refer: https://docs.microsoft.com/en-in/azure/service-fabric/service-fabric-cluster-creation-setup-aad                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_ServiceFabric\_DP\_Set\_Property\_ClusterProtectionLevel            | The ClusterProtectionLevel property must be set to EncryptAndSign                                                                      | Service Fabric provides three levels of protection (None, Sign and EncryptAndSign) for node to node communication using cluster primary certificate. The protection level can be specified using property 'ClusterProtectionLevel' inside Service Fabric ARM template. The value of 'ClusterProtectionLevel' must be set to 'EncryptAndSign' to ensure that all the node-to-node messages are encrypted and digitally signed. Configure 'ClusterProtectionLevel' using ARM template as follows: ARM Template --> Resources --> Select resource type 'Microsoft.ServiceFabric/clusters' --> 'fabricSettings' --> Add 'ClusterProtectionLevel' property with value 'EncryptAndSign'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Azure\_ServiceFabric\_AuthN\_NSG\_Enabled                                  | Enable Firewall/NSGs on subnet of Service Fabric cluster                                                                               | NSG contains a list of Access Control List (ACL) rules that allow or deny network traffic to Service Fabric node instances in a Virtual Network. NSGs can be associated with either subnets or individual node/VM instances within a subnet. NSG must be used in following scenarios: (1) Restrict RDP connection only from admin machine IP,  (2) Restrict microservice incoming request from trusted source IP, (3) Lock down the remote address ranges allowed for microservice deployments. Refer: https://azure.microsoft.com/en-in/documentation/articles/virtual-networks-create-nsg-arm-pportal/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Azure\_ServiceFabric\_Audit\_Publicly\_Exposed\_Load\_Balancer\_Ports      | Monitor publicly exposed ports on load balancers used by Service Fabric cluster                                                        | Azure load balancer maps the public IP address and port number of incoming traffic to the private IP address and port number of the Service Fabric nodes (ports number opened by microservices). Intranet microservice ports must not be exposed to the internet. Moreover, publicly exposed IP address/port numbers must be monitored using Azure load balancer rules as follows: Azure Portal --> Load Balancers --> <Load Balancer Name> --> Load Balancing Rules --> Validate mapping of public end port with backend port.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_ServiceFabric\_DP\_Dont\_Expose\_Reverse\_Proxy\_Port               | Reverse proxy port must not be exposed publicly                                                                                        | Check that reverse proxy port is not be exposed through Azure Load Balancer rules as follows: Azure Portal --> Load Balancers --> <Load Balancer Name> --> Load Balancing Rules --> Validate reverse proxy port is not exposed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_ServiceFabric\_SI\_Set\_Auto\_Update\_Cluster                       | Upgrade mode should be set to automatic for cluster                                                                                    | You can set your cluster to receive automatic fabric upgrades as they are released by Microsoft, for details please refer: https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-upgrade                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_SQLManagedInstance\_Audit\_Enable\_Vuln\_Assessment                 | Vulnerability assessment must be enabled on your SQL managed instances                                                                 | First run command 'Enable-AzSqlInstanceAdvancedDataSecurity -ResourceGroupName '{ResourceGroupName}' -InstanceName '{InstanceName}''. Then run command 'Update-AzSqlInstanceVulnerabilityAssessmentSetting -ResourceGroupName '{ResourceGroupName}' -InstanceName '{InstanceName}' -StorageAccountName '{StorageAccountName}' -ScanResultsContainerName 'vulnerability-assessment' -RecurringScansInterval Weekly -EmailAdmins $true -NotificationEmail @('mail1@mail.com' , 'mail2@mail.com')'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Azure\_SQLManagedInstance\_SI\_Remediate\_Security\_Vulnerabilities        | Vulnerabilities on your SQL databases should be remediated                                                                             | Go to security center --> Data & storage --> SQL --> Click on SQL DB Managed instance --> Click on Recommendation in Recommendation List --> Remediate list of vulnerabilities                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_SQLDatabase\_AuthZ\_Use\_AAD\_Admin                                 | Use AAD Authentication for SQL Database                                                                                                | Run command Set-AzSqlServerActiveDirectoryAdministrator -ResourceGroupName '{ResourceGroupName}' -ServerName '{ServerName}' -DisplayName '{AzureAdAdmin Display Name}' Refer: https://docs.microsoft.com/en-us/powershell/module/az.sql/set-azsqlserveractivedirectoryadministrator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Azure\_SQLDatabase\_DP\_Enable\_TDE                                        | Transparent data encryption (TDE) must be enabled                                                                                      | Run command Set-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName '{ResourceGroupName}' -ServerName '{ServerName}' -DatabaseName '{DatabaseName}' -State 'Enabled'. Refer: https://docs.microsoft.com/en-us/powershell/module/az.sql/set-azsqldatabasetransparentdataencryption \*Note:If Blob Auditing or Threat Detection are enabled on the server, they will always apply to the database, regardless of the database level settings.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Azure\_SQLDatabase\_Audit\_Enable\_Threat\_Detection\_Server               | Enable advanced data security on your SQL servers                                                                                      | First run command 'Set-AzSqlServerAudit -ResourceGroupName '{ResourceGroupName}' -ServerName '{ServerName}' -StorageAccountResourceId '{StorageAccountResourceId}' -BlobStorageTargetState 'Enabled' -RetentionInDays 365'.Refer: https://docs.microsoft.com/en-us/powershell/module/az.sql/set-azsqlserveraudit. Then run command 'Update-AzSqlServerAdvancedThreatProtectionSetting -ResourceGroupName '{ResourceGroupName}' -ServerName '{ServerName}' -StorageAccountName '{StorageAccountName}' -EmailAdmins \`$true -ExcludedDetectionType 'None''.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Azure\_SQLDatabase\_NetSec\_Dont\_Allow\_Universal\_IP\_Range              | Do not use Any-to-Any IP range for Azure SQL Database                                                                                  | Do not configure Any to Any firewall IP address. Run command Remove-AzSqlServerFirewallRule -FirewallRuleName '{AnyToAny FirewallRule Name}' -ResourceGroupName '{ResourceGroupName}' -ServerName '{ServerName}'. Refer: https://docs.microsoft.com/en-us/powershell/module/az.sql/Remove-AzSqlServerFirewallRule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Azure\_SQLDatabase\_Audit\_Enable\_Logging\_and\_Monitoring\_Server        | Ensure Azure SQL Server auditing is configured correctly                                                                               | Run command Set-AzSqlServerAudit -ResourceGroupName '{ResourceGroupName}' -ServerName '{ServerName}' -StorageAccountResourceId '{StorageAccountResourceId}' -BlobStorageTargetState 'Enabled' -RetentionInDays 365. Refer: https://docs.microsoft.com/en-us/powershell/module/az.sql/set-azsqlserveraudit. Through Portal: After logging into subscription, go under Home -> Select Azure SQL server -> Under security section select auditing. Ensure auditing is turned ON. If selecting storage, ensure that the retention period is set to at least 365 days.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Azure\_SQLDatabase\_AuthZ\_Firewall\_Deny\_Access\_AzureServices           | Use the 'Allow access to Azure services' flag only if required                                                                         | Turn off the allow access to Azure services flag. Run command Remove-AzSqlServerFirewallRule -FirewallRuleName 'AllowAllWindowsAzureIps' -ResourceGroupName '{ResourceGroupName}' -ServerName '{ServerName}'. Refer: https://docs.microsoft.com/en-us/powershell/module/az.sql/remove-azsqlserverfirewallrule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Azure\_SQLDatabase\_Audit\_Enable\_Vuln\_Assessment                        | Enable Vulnerability assessment on your SQL servers                                                                                    | First run command 'Enable-AzSqlServerAdvancedDataSecurity -ResourceGroupName '{ResourceGroupName}' -ServerName '{ServerName}''. Then run command 'Update-AzSqlServerVulnerabilityAssessmentSetting -ResourceGroupName '{ResourceGroupName}' -ServerName '{ServerName}' -StorageAccountName '{StorageAccountName}' -ScanResultsContainerName 'vulnerability-assessment' -RecurringScansInterval Weekly -EmailAdmins $true -NotificationEmail  @('mail1@mail.com' , 'mail2@mail.com')'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Azure\_SQLDatabase\_SI\_Remediate\_Security\_Vulnerabilities               | Vulnerabilities on your SQL databases must be remediated                                                                               | Go to security center --> Data & storage --> SQL --> Click on SQL server name --> Click on Recommendation in Recommendation List --> Remediate list of vulnerabilities                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Azure\_Storage\_AuthN\_Dont\_Allow\_Anonymous                              | Ensure secure access to storage account containers.                                                                                    | Run command 'Set-AzStorageContainerAcl -Name '<ContainerName>' -Permission 'Off' -Context (New-AzStorageContext -StorageAccountName '<StorageAccountName>' -StorageAccountKey '<StorageAccountKey>')'. Run 'Get-Help Set-AzStorageContainerAcl -full' for more help.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Azure\_Storage\_DP\_Encrypt\_In\_Transit                                   | Enable Secure transfer to storage accounts                                                                                             | Run command 'Set-AzStorageAccount -ResourceGroupName <RGName> -Name <StorageAccountName> -EnableHttpsTrafficOnly \`$true'. Run 'Get-Help Set-AzStorageAccount -full' for more help.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Azure\_Storage\_NetSec\_Restrict\_Network\_Access                          | Ensure that Firewall and Virtual Network access is granted to a minimal set of trusted origins                                         | Go to Azure Portal --> your Storage service --> Settings --> Firewalls and virtual networks --> Selected Network. Provide the specific IP address and Virtual Network details that should be allowed to access storage account.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_Storage\_DP\_Use\_Secure\_TLS\_Version\_Trial                       | \[Trial\] Use approved version of TLS for Azure Storage                                                                                | Configure 'Minimum TLS Version' setting for Azure Storage account. Refer: https://docs.microsoft.com/en-us/azure/storage/common/transport-layer-security-configure-minimum-version?tabs=powershell#configure-the-minimum-tls-version-for-a-storage-account                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Azure\_Subscription\_AuthZ\_Remove\_Deprecated\_Accounts                   | Remove Orphaned accounts from your subscription(s)                                                                                     | Steps to remove role assignments of deprecated/invalid accounts are:  a. To remove permanent role assignment use command 'Remove-AzRoleAssignment' or refer link, https://docs.microsoft.com/en-us/azure/role-based-access-control/role-assignments-remove#azure-portal b. To remove classic role assignments, refer link: https://docs.microsoft.com/en-us/azure/role-based-access-control/classic-administrators#remove-a-co-administrator c. To remove PIM role assignments, refer link https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-how-to-add-role-to-user?tabs=new#update-or-remove-an-existing-role-assignment. For bulk remediation of permanent and classic role assignments using PowerShell, refer https://aka.ms/azts-docs/rscript/Azure\_Subscription\_AuthZ\_Remove\_Deprecated\_Accounts.                                                                                                                                                                                                                                                                                                                 |
| Azure\_Subscription\_AuthZ\_Dont\_Use\_NonAD\_Identities                   | Remove external accounts from Azure subscriptions                                                                                      | Run command Remove-AzRoleAssignment -SignInName '{signInName}' -Scope '{scope}' -RoleDefinitionName '{role definition name}'. Run 'Get-Help Remove-AzRoleAssignment -full' for more help. For bulk remediation using PowerShell, refer https://aka.ms/azts-docs/rscript/Azure\_Subscription\_AuthZ\_Dont\_Use\_NonAD\_Identities                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Azure\_Subscription\_AuthZ\_Limit\_ClassicAdmin\_Count                     | Limit access per subscription to 2 or less classic administrators                                                                      | You need to remove any 'Classic Administrators/Co-Administrators' who should not be in the role. Please follow these steps: (a) Logon to https://portal.azure.com/ (b) Navigate to Subscriptions (c) Select the subscription (d) Go to 'Access Control (IAM)' and select the 'Classic Administrators' tab. (e) Select the co-administrator account that has to be removed and click on the 'Remove' button. (f) Perform this operation for all the co-administrators that need to be removed from the subscription.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Azure\_Subscription\_AuthZ\_Remove\_Management\_Certs                      | Do not use management certificates                                                                                                     | You need to remove any management certificates that are not required. Please follow these steps: (a) Logon to https://portal.azure.com/ (b) Navigate to Subscriptions (c) Select the subscription (d) Go to Settings tab  --> Management Certificates tab --> Delete unwanted management certificates.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Azure\_Subscription\_Audit\_Resolve\_Azure\_Security\_Center\_Alerts       | Pending Azure Security Center (ASC) alerts must be resolved                                                                            | You need to address all active alerts on Azure Security Center. Please follow these steps: (a) Logon to https://portal.azure.com/ (b) Navigate to Security Center. (c) Click on Security Alerts under 'Threat Protection' category. (d) Take appropriate actions on all active alerts.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Azure\_Subscription\_SI\_Classic\_Resources                                | Remove classic resources on a subscription                                                                                             | Migrate each v1/ASM-based resource in your app to a corresponding v2/ARM-based resource. Refer: https://docs.microsoft.com/en-us/azure/virtual-machines/windows/migration-classic-resource-manager-overview                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_Subscription\_AuthZ\_Dont\_Grant\_Persistent\_Access                | Do not grant permanent access for privileged subscription level roles                                                                  | Use Privileged Identity Management (PIM) to grant access to privileged roles at subscription scope. To remove existing assignments run: 'Remove-AzRoleAssignment -SignInName '{signInName}' -Scope '/subscriptions/{subscriptionid}' -RoleDefinitionName {RoleDefinitionName}'. Refer https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/azure-pim-resource-rbac#assign-roles.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Azure\_Subscription\_AuthZ\_Dont\_Grant\_Persistent\_Access\_RG            | Do not grant permanent access for privileged roles at resource group level                                                             | Use Privileged Identity Management (PIM) to grant access to privileged roles at resource group scope. To remove existing assignments run: 'Remove-AzRoleAssignment -SignInName '{signInName}' -Scope '/subscriptions/{subscriptionid}/resourceGroups/{resourceGroupName}' -RoleDefinitionName {RoleDefinitionName}'. Refer https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/azure-pim-resource-rbac#assign-roles.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Azure\_Subscription\_Config\_Add\_Required\_Tags                           | Mandatory tags must be set per your organization policy                                                                                | Refer: https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-using-tags#portal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Azure\_Subscription\_Config\_ASC\_Defender                                 | Enable all Azure Defender plans in Azure Security Center                                                                               | Refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-pricing. For bulk remediation using PowerShell, refer https://aka.ms/azts-docs/rscript/Azure\_Subscription\_Config\_ASC\_Defender                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_Subscription\_Use\_Only\_Alt\_Credentials                           | Use Smart-Card ALT (SC-ALT) accounts to access subscription                                                                            | Go to Azure portal -> Privileged Identity Management -> Azure Resources -> Select the scope -> Members-> Eligible roles and verify the non alternate accounts. Ensure that only alternate accounts are used as members of critical roles in the subscription. Do not use day to day user accounts.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Azure\_Subscription\_Config\_ASC\_Enable\_AutoProvisioning                 | Turn on Microsoft Monitoring Agent (MMA) to enable Security Monitoring                                                                 | For setting AutoProvisioning settings for your subscription, go to azure portal https://portal.azure.com. On the portal go to -->Security center - Pricing & Settings-->Select your subscription-->Settings - Data Collection, you can also run command 'Set-AzSKAzureSecurityCenterPolicies -SubscriptionId '<SubscriptionId>'' for setting up AutoProvisioning settings                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Azure\_Subscription\_Config\_ASC\_Setup\_SecurityContacts                  | A security contact and alerts must be configured for your subscription                                                                 | On Azure portal, go to Security Center -> Pricing & settings (select subscription id) -> Email notifications -> a. Select 'Owner' and 'Account Admin' as email recipients or explicitly specify the email recipients b. Select checkbox to notify about alerts c. Alert severity should be set to atleast 'Medium' -> Save.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_Subscription\_SI\_No\_Billing\_Activity\_Trial                      | \[Trial\] Subscriptions with no billing activity and resources must be deleted.                                                        | To cancel subscription in the Azure portal, 1. Select your subscription from the Subscriptions page in the Azure portal. 2. Select the subscription that you want to cancel. 3. Select Overview, and then select Cancel subscription. 4. Follow prompts and finish cancellation. For detailed instructions, refer: https://docs.microsoft.com/en-us/azure/cost-management-billing/manage/cancel-azure-subscription.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Azure\_Subscription\_Configure\_Conditional\_Access\_for\_PIM              | Enable policy to require PIM elevation from SAW for admin roles in Azure subscriptions                                                 | Run Set-AzSKPIMConfiguration -ConfigureRoleSettings -SubscriptionId \`$subid -RoleName \`$roleName  -ApplyConditionalAccessPolicyForRoleActivation \`$true for Owner, Contributor and User Access Administrator roles for the subscription. For Owner, UAA at Resource Group level, run Set-AzSKPIMConfiguration -ConfigureRoleSettings -SubscriptionId \`$subid -ResourceGroupName \`$RGName -RoleName \`$roleName -ApplyConditionalAccessPolicyForRoleActivation \`$true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Azure\_TrafficManager\_DP\_Enable\_HTTPS                                   | Traffic Manager profile should use HTTPS protocol for endpoint monitoring                                                              | To enable HTTPS protocol for endpoint monitoring, go to Azure Portal --> your Traffic Manager Profile --> Configuration -->  Select HTTPS --> Save.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Azure\_VirtualMachine\_SI\_Enable\_Antimalware                             | Ensure all devices have anti-malware protection installed and enabled                                                                  | To install antimalware, Go to Azure Portal --> VM Properties --> Extensions --> Add 'Microsoft Antimalware' --> Enable Real-Time Protection and Scheduled Scan --> Click Ok. If antimalware is already present on VM, validate and resolve endpoint protection recommendations in ASC. Refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-install-endpoint-protection, https://docs.microsoft.com/en-us/azure/security/azure-security-antimalware                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Azure\_VirtualMachine\_Config\_Enable\_NSG                                 | Internet-facing virtual machines must be protected with Network Security Groups                                                        | Refer: https://docs.microsoft.com/en-us/azure/virtual-machines/windows/endpoints-in-resource-manager, https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-create-nsg-arm-ps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_VirtualMachine\_NetSec\_Justify\_PublicIPs                          | Public IPs on a Virtual Machine should be carefully reviewed                                                                           | Go to Azure Portal --> VM Settings --> Networking --> Network Interfaces --> <Select NIC> --> IP Configurations --> <Select IP Configs with Public IP> --> Click 'Disabled' --> Save. Refer: https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-public-ip-address                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Azure\_VirtualMachine\_DP\_Enable\_Disk\_Encryption                        | Disk encryption should be applied on virtual machines                                                                                  | Refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-disk-encryption?toc=%2fazure%2fsecurity%2ftoc.json. Note: After enabling disk encryption, it takes some time for changes to reflect in Azure Security Center (ASC). Thus, if you scan immediately, the control may still fail even though the VM itself shows as encrypted. Please wait a few hours to ascertain the fix.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Azure\_VirtualMachine\_SI\_ASC\_OS\_Vulnerabilities                        | Virtual Machine must be in a healthy state in Azure Security Center                                                                    | Refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-remediate-os-vulnerabilities                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Azure\_VirtualMachine\_SI\_Missing\_OS\_Patches                            | Patch virtual machine to protect against vulnerabilities                                                                               | Refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-apply-system-updates . It takes 24 hours to reflect the latest status at ASC.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_VirtualMachine\_SI\_ASC\_Recommendations                            | Virtual Machine must implement all the flagged ASC recommendations                                                                     | First, examine the detailed AzSK log file for this VM to find out the specific recommendations this control is currently failing for. Review the ASC documentation for those recommendations and implement the suggested fixes. (Note: Not all ASC recommendations are flagged by AzSK. So the first step is critical.). Refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-virtual-machine-recommendations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Azure\_VirtualMachine\_Audit\_Enable\_Diagnostics                          | Diagnostics must be enabled on the Virtual Machine                                                                                     | Go to Azure Portal --> VM Properties --> Diagnostics settings --> Enable guest-level-monitoring. Refer: https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/azure-diagnostics                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_VirtualMachine\_SI\_Enable\_Vuln\_Solution                          | Install DSRE Qualys Cloud Agent on assets                                                                                              | To install vulnerability assessment solution, please refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-vulnerability-assessment-recommendations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_VirtualMachine\_SI\_Deploy\_GuestConfig\_Extension                  | Guest Configuration extension must be deployed to the VM using Azure Policy assignment                                                 | This control checks that the VM meets the following criteria: \[a\] Guest Configuration Extension is installed and provisioned successfully, \[b\] 'SystemAssigned' managed identity (MSI) is enabled for the VM. Both, the required Guest Configuration extension and a system-assigned MSI, will be automatically deployed and configured when the machine is in scope for an Azure Policy assignment that includes definitions in the Guest Configuration category.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Azure\_VirtualMachine\_SI\_Enable\_Monitoring\_Agent                       | Ensure the MMA on your VM is healthy (running successfully)                                                                            | Please refer: https://docs.microsoft.com/en-us/azure/azure-monitor/agents/azure-monitor-agent-install?context=/azure/virtual-machines/context/context                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Azure\_VirtualMachine\_NetSec\_Dont\_Open\_Restricted\_Ports               | Management ports must not be open on machines                                                                                          | Go to Azure Portal --> VM Settings --> Networking --> Inbound security rules --> Select security rule which allows management ports (e.g. RDP-3389, WINRM-5985, SSH-22, SMB-445) --> Click 'Deny' under Action --> Click Save.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_VirtualMachine\_NetSec\_Dont\_Open\_Restricted\_Ports\_Trial        | \[Trial\] Management ports must not be open on machines                                                                                | Go to Azure Portal --> VM Settings --> Networking --> Inbound security rules --> Select security rule which allows management ports (e.g. RDP-3389, WINRM-5985, SSH-22, SMB-445) --> Click 'Deny' under Action --> Click Save.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_VirtualMachine\_SI\_Deploy\_Data\_Collection\_Extension             | \[Preview\]: Install Network data collection agents                                                                                    | Please refer: https://docs.microsoft.com/en-us/azure/azure-monitor/agents/diagnostics-extension-overview                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Azure\_VirtualMachine\_NetSec\_Apply\_ASC\_Network\_Recommendations        | Apply Adaptive Network Hardening to Internet facing virtual machines                                                                   | Please refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-adaptive-network-hardening#what-is-adaptive-network-hardening                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Azure\_VirtualMachine\_SI\_Remediate\_Security\_Vulnerabilities            | Vulnerabilities in security configuration on your machines must be remediated.                                                         | Go to security center --> Compute & apps --> VMs and Servers --> Click on VM name --> Click on VM Vulnerability remediation recommendation --> Click on Take Action --> Remediate list of vulnerabilities                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Azure\_VirtualMachine\_SI\_Remediate\_Container\_Security\_Vulnerabilities | Vulnerabilities in container security configurations must be remediated                                                                | Go to security center --> Compute & apps --> Containers --> Click on VM name --> Click on VM Container Vulnerability remediation recommendation --> Click on Take Action --> Remediate list of vulnerabilities                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_VirtualMachine\_Just\_In\_Time\_Network\_Access\_Control            | Just-In-Time network access control must be applied on virtual machines                                                                | Go To Security Center --> Just in time VM access --> Go To Not Configured --> Select your VM --> Click on Enable JIT on 1 VMs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Azure\_VirtualMachine\_SI\_Remediate\_Assessment\_Soln\_Vulnerabilities    | Vulnerabilities must be remediated by a Vulnerability Assessment solution                                                              | Go to security center --> Compute & apps --> VMs and Servers --> Click on VM name --> Click on VM Vulnerability remediation recommendation by Assessment solution --> Click on Take Action --> Remediate list of vulnerabilities                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Azure\_VirtualMachine\_NetSec\_Open\_Allowed\_Ports\_Only                  | Only allowed ports must be opened on Virtual Machines                                                                                  | Go to Azure Portal --> VM Settings --> Networking --> Inbound security rules --> Select security rule which allows management ports (e.g. RDP-3389, WINRM-5985, SSH-22) --> Click 'Deny' under Action --> Click Save.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Azure\_VirtualMachine\_SI\_Enable\_Sense\_Agent                            | Ensure Sense Agent is installed and healthy                                                                                            | NA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Azure\_VirtualMachineScaleSet\_Deploy\_Monitoring\_Agent                   | Log analytics agent should be installed on Virtual Machine Scale Set                                                                   | Run following commands: 1- \`$allVersions= (Get-AzVMExtensionImage -Location 'eastus' -PublisherName 'Microsoft.EnterpriseCloud.Monitoring' -Type 'MicrosoftMonitoringAgent or OmsAgentForLinux').Version 2- \`$versionString = \`$allVersions\[(\`$allVersions.count)-1\].Split('.')\[0\] + '.' + \`$allVersions\[(\`$allVersions.count)-1\].Split('.')\[1\] 3- \`$VMSS = Get-AzVmss -ResourceGroupName <VMSS RG Name> -VMScaleSetName <VMSS Name> 4- Add-AzVmssExtension -VirtualMachineScaleSet \`$VMSS -Name 'MicrosoftMonitoringAgent' -Publisher 'Microsoft.EnterpriseCloud.Monitoring' -Type 'MicrosoftMonitoringAgent or OmsAgentForLinux' -TypeHandlerVersion \`$versionString -Setting '{'workspaceId': '<your workspace ID here>'}' -ProtectedSetting '{'workspaceKey': '<your workspace key here>'}' 5- Update-AzVmss -ResourceGroupName <VMSS RG Name> -Name <VMSS Name> -VirtualMachineScaleSet \`$VMSS                                                                                                                                                                                                                                                  |
| Azure\_VirtualMachineScaleSet\_SI\_Enable\_Antimalware                     | Antimalware must be enabled with real time protection on Virtual Machine Scale Set                                                     | To install antimalware, Go to Azure Portal --> VMSS --> Settings --> Extensions --> Add 'Microsoft Antimalware' --> Enable Real-Time Protection and Scheduled Scan --> Click Ok. To turn on antimalware using powershell,refer: https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-faq#how-do-i-turn-on-antimalware-in-my-virtual-machine-scale-set                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Azure\_VirtualMachineScaleSet\_Audit\_Enable\_Diagnostics                  | Diagnostics (IaaSDiagnostics extension on Windows; LinuxDiagnostic extension on Linux) must be enabled on Virtual Machine Scale Set    | Refer: https://docs.microsoft.com/en-us/cli/azure/vmss/diagnostics?view=azure-cli-latest                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Azure\_VirtualMachineScaleSet\_DP\_Enable\_Disk\_Encryption                | Disk encryption should be applied on virtual machine scale sets                                                                        | Refer: https://docs.microsoft.com/en-in/azure/virtual-machine-scale-sets/disk-encryption-powershell                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Azure\_VirtualMachineScaleSet\_SI\_Latest\_Model\_Applied                  | All VMs in VM Scale Set must be up-to-date with the latest scale set model                                                             | Please refer: https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-upgrade-scale-set#how-to-bring-vms-up-to-date-with-the-latest-scale-set-model.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Azure\_VirtualMachineScaleSet\_NetSec\_Justify\_PublicIPs                  | Public IPs on a Virtual Machine Scale Set instances should be carefully reviewed                                                       | Refer: https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#public-ipv4-per-virtual-machine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_VirtualMachineScaleSet\_Config\_Enable\_NSG                         | NSG must be configured for Virtual Machine Scale Set                                                                                   | To apply NSG at scale set, refer: https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#nsg--asgs-per-scale-set or to apply NSG at subnet level, refer: https://docs.microsoft.com/en-us/azure/virtual-network/tutorial-filter-network-traffic#associate-network-security-group-to-subnet                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_VirtualMachineScaleSet\_NetSec\_Dont\_Open\_Management\_Ports       | Management ports must not be open on Virtual Machine Scale Sets                                                                        | Go to Azure Portal --> VM Scale Set --> Settings --> Networking --> Inbound security rules --> Select security rule which allows management ports (e.g. RDP-3389, WINRM-5985, SSH-22, SMB-445) --> Click 'Delete' under Action --> Click Save.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_VirtualMachineScaleSet\_SI\_Enable\_Auto\_OS\_Upgrade               | Enable automatic OS image upgrade on Virtual Machine Scale Set                                                                         | To configure auto OS image upgarde on VM Scale Set, please refer: https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-automatic-upgrade                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Azure\_VirtualMachineScaleSet\_SI\_Missing\_OS\_Patches                    | System updates on virtual machine scale sets must be installed                                                                         | Refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-apply-system-updates . It takes 24 hours to reflect the latest status at ASC.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_VirtualMachineScaleSet\_SI\_Remediate\_Security\_Vulnerabilities    | Vulnerabilities in security configuration on your virtual machine scale sets must be remediated.                                       | Go to security center --> Compute & apps --> VM scale sets --> Click on VMSS name --> Click on VMSS Vulnerability remediation recommendation --> Click on Take Action --> Remediate list of vulnerabilities                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_ERvNet\_NetSec\_Dont\_Use\_PublicIPs                                | Remove public IPs on ER connected VMs                                                                                                  | Any Public IP addresses you added to an ER-connected virtual network must be removed. Refer: https://docs.microsoft.com/en-us/powershell/module/az.network/Remove-AzPublicIpAddress                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Azure\_ERvNet\_NetSec\_Dont\_Use\_Multi\_NIC\_VMs                          | There must not be multiple NICs on ExpressRoute-connected VMs                                                                          | Remove any additional NICs on VMs which are on an ER-connected virtual network. Refer: http://stackoverflow.com/questions/34526032/how-can-i-programmatically-detach-a-nic-from-its-vm-in-azure-arm                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Azure\_ERvNet\_NetSec\_Dont\_Enable\_IPForwarding\_for\_NICs               | Set 'EnableIPForwarding' flag to false for NICs in the ExpressRoute-connected vNet                                                     | IP Forwarding must be disabled on ExpressRoute-connected NICs. Refer: https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Azure\_ERvNet\_NetSec\_Dont\_Add\_UDRs\_on\_Subnets                        | There must not be a UDR on \*any\* subnet in an ExpressRoute-connected vNet                                                            | Remove association between any UDRs you may have added and respective subnets using the 'Remove-AzureSubnetRouteTable' command. Run 'Get-Help Remove-AzureSubnetRouteTable -full' for more help.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Azure\_ERvNet\_NetSec\_Dont\_Add\_VPN\_Gateways                            | There must not be another virtual network gateway (GatewayType = Vpn) in an ExpressRoute-connected vNet                                | Remove any VPN Gateways from the ExpressRoute-connected virtual network. Refer: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-delete-vnet-gateway-powershell                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Azure\_ERvNet\_NetSec\_Dont\_Use\_VNet\_Peerings                           | Peering must not be allowed on ExpressRoute connected Virtual Network                                                                  | Remove any VNet peering you added using the 'Remove-AzVirtualNetworkPeering' PS command. Run 'Get-Help Remove-AzVirtualNetworkPeering -full' for more help.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Azure\_ERvNet\_SI\_Add\_Only\_Network\_Resources                           | Add only Microsoft.Network/\* resources to the ERNetwork resource group                                                                | Move all other resources except Microsoft.Network/\* to another resource group. To move a resource, simply go to the Overview tab for it in the Azure portal and select the Move option.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Azure\_ERvNet\_SI\_Dont\_Remove\_Resource\_Lock                            | Ensure that the ERNetwork resource group is protected with a resource lock                                                             | Create a ReadOnly resource lock for every ER Network resource group using command New-AzResourceLock -LockName '{LockName}' -LockLevel 'ReadOnly' -Scope '/subscriptions/{SubscriptionId}/resourceGroups/{ERNetworkResourceGroup}'. Run 'Get-Help New-AzResourceLock -full' for more help.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Azure\_ERvNet\_NetSec\_Revoke\_PublicIPs\_On\_Sub                          | There must not be any Public IPs on Subscription with ExpressRoute connection                                                          | Any Public IP addresses you added to an ER-connected virtual network must be removed. Refer: https://docs.microsoft.com/en-us/powershell/module/az.network/Remove-AzPublicIpAddress                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Azure\_VNet\_NetSec\_Justify\_Peering                                      | Assure virtual network peering is not allowed                                                                                          | You can remove any virtual network peerings using the Remove-AzVirtualNetworkPeering command (unless their presence has been approved by network security team). Run 'Get-Help Remove-AzVirtualNetworkPeering -full' for more help.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Azure\_VNet\_NetSec\_Configure\_NSG                                        | Associate Subnets with a Network Security Group                                                                                        | Configure NSG rules to be as restrictive as possible via: (a) Azure Portal -> Network security groups -> <Your NSG> -> Inbound security rules -> Edit 'Allow' action rules. (b) Azure Portal -> Network security groups. -> <Your NSG> -> Outbound security rules -> Edit 'Allow' action rules                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Azure\_VNet\_NetSec\_Justify\_PublicIPs                                    | Minimize the number of Public IPs (i.e. NICs with PublicIP) on a virtual network                                                       | Unutilized Public IP address must be removed from virtual network. For more information visit: https://docs.microsoft.com/en-us/powershell/module/az.network/remove-azpublicipaddress                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Azure\_VNet\_NetSec\_Justify\_Gateways                                     | Presence of any virtual network gateways (GatewayType = VPN/ExpressRoute) in the virtual network must be justified                     | You can remove virtual network gateways using the Remove-AzVirtualNetworkGateway command (unless their presence has been approved by network security team). Run 'Get-Help Remove-AzVirtualNetworkGateway -full' for more help.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Azure\_VNet\_NetSec\_Justify\_IPForwarding\_for\_NICs                      | Use of IP Forwarding on any NIC in a virtual network should be scrutinized                                                             | Disable IP Forwarding unless it has been reviewed and approved by network security team. Go to Azure Portal --> Navigate to VM NIC (where IP Forwarding is enabled) --> IP Configurations --> IP Forwarding settings --> Click on 'Disabled'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
