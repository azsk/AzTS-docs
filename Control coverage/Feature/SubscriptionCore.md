## SubscriptionCore

| ControlId | Dependent Azure API(s) and Properties | Control spec-let |
|-----------|---------------------------------------|------------------|
| <b>ControlId:</b><br>Azure_Subscription_Config_ASC_Enable_AutoProvisioning<br><b>DisplayName:</b><br>Turn on Microsoft Monitoring Agent (MMA) to enable Security Monitoring.<br><b>Description: </b><br>Auto Provisioning must be set to ON in Azure Security Center. | <b>ARM API to list auto provisioning settings at <br>subscription level:</b><br>/subscriptions/{subscriptionId}/providers<br>/Microsoft.Security/autoProvisioningSettings<br>/default?api-version=2017-08-01-preview<br><b>Property:</b><br>autoProvision | <b>Passed: </b><br>Auto Provisioning is enabled.<br><b>Failed: </b><br>Auto Provisioning is not enabled or if security center provider is not registered.<br><b>Verify: </b><br>Unable to verify Auto Provisioning detail. |
| <b>ControlId:</b><br>Azure_Subscription_Config_ASC_Defender<br><b>DisplayName:</b><br>Enable all Azure Defender plans in Azure Security Center.<br><b>Description: </b><br>Enable all Azure Defender plans in Azure Security Center. | <b>ARM API to list Security Center pricing <br>configurations in the subscription:</b><br>/subscriptions/{subscriptionId}/providers<br>/Microsoft.Security/pricings?api-version=2018-06-01<br><b>Properties:</b><br>pricingTier, name | <b>Passed: </b><br>All required resource types are configured with ASC standard tier.<br><b>Failed: </b><br>Any of resource types is not configured with ASC standard tier or if security center provider is not registered. |
| <b>ControlId:</b><br>Azure_Subscription_AuthZ_Dont_Use_NonAD_Identities<br><b>DisplayName:</b><br>Remove external accounts from Azure subscriptions<br><b>Description: </b><br>Do not grant permissions to external accounts (i.e., accounts outside the native directory for the subscription). | <b>PIM API to get role assignments:</b><br> /beta/privilegedAccess/azureResources<br>/resources/{uniquePIMIdentifier}/roleAssignments<br>?$expand=subject,roleDefinition<br>($expand=resource)&$filter=(memberType%20ne%20'{filterCondition}')<br><b>Property:</b><br>subject/principalName<br><br><b>ARM API to list classic role assignment at <br>subscription level:</b><br>subscriptions/{subscriptionId}/providers<br>/Microsoft.Authorization/classicAdministrators<br>?api-version=2015-06-01<br><b>Property:</b><br> emailAddress | <b>Passed: </b><br>No external account is found at subscription scope.<br><b>Failed: </b><br>External account is found at subscription scope.<br><b>Verify: </b><br>RBAC result not found (sufficient data is not available for evaluation). |
| <b>ControlId:</b><br>Azure_Subscription_AuthZ_Remove_Deprecated_Accounts<br><b>DisplayName:</b><br>Remove Orphaned accounts from your subscription(s)<br><b>Description: </b><br>Deprecated/stale accounts must not be present on the subscription. | <b>ARM API to list role assignment at scope:</b> <br>/{scope}/providers/Microsoft.Authorization/role<br>Assignments?api-version=2018-01-01-preview<br><b>Property:</b> principalId<br><br><b>PIM API to get role assignment:</b> /beta/privilegedAccess/azureResources<br>/resources/{uniquePIMIdentifier}/roleAssignments<br>?$expand=subject,roleDefinition<br>($expand=resource)&$filter=<br>(memberType%20ne%20'{filterCondition}')<br><b>Property:</b><br> subject/id<br><br><b>ARM API to list security assessments at <br>subscription level:</b><br>/subscriptions/{subscriptionId}/providers<br>/Microsoft.Security/assessments<br>?api-version=2020-01-01<br><b>Properties:</b><br>id, name, resourceDetails/Id, displayName, status/code, status, additionalData| <b>Passed: </b><br>No deprecated account is found at subscription scope (in both ASC and Reader scan).<br><b>Failed: </b><br>Deprecated account is found at subscription scope (in any one of ASC and Reader scan).<br><b>Verify: </b><br>ASC assessment status is not applicable or policy is missing. |
| <b>ControlId:</b><br> Azure_Subscription_Audit_Resolve_Azure_Security_Center_Alerts <br><b>DisplayName:</b><br> Pending Azure Security Center (ASC) alerts must be resolved. <br><b>Description: </b><br> Pending Azure Security Center (ASC) alerts must be resolved. | <b> ARM API to list all the alerts that are associated with the subscription: </b> <br> /subscriptions/{subscriptionId}/providers/microsoft.Security/alerts? <br> api-version=2015-06-01-preview <br><b>Properties:</b><br> properties.state <br> properties.reportedSeverity <br> properties.reportedTimeUtc | <b>Passed: </b><br> a. There are no active ASC Alerts. <br> b. There is no active alert which is beyond defined grace. <br><b>Failed: </b><br> There are ASC alerts in the subscription which are active beyond the defined grace. <i> <br><br> - Alert Severity: High <br> - Grace period: 0 <br><br> - Alert Severity: Medium<br> - Grace period: 30 </i>|
| <b>ControlId:</b><br>Azure_Subscription_Config_ASC_Setup_SecurityContacts<br><b>DisplayName:</b><br>A security contact and alerts must be configured for your subscription. <br><b>Description: </b><br> Security contact details must be configured in Azure Security Center. | <b> ARM API to list all security contact configurations for the subscription: </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.Security/securityContacts? <br> api-version=2020-01-01-preview <br> properties.emails <br> properties.phone <br> properties.alertNotifications.state <br> properties.alertNotifications.minimalSeverity <br> properties.notificationsByRole.state <br> properties.notificationsByRole.roles | <b>Passed: </b><br>  <br> ASC security contact setting meet the following conditions: <br> &nbsp; 1.a. 'Owner' and 'Account Admin' should be selected as email recipients. <br>   &nbsp; 1.b. At least one email id is specified as email recipients. <br>   &nbsp; 1.c. Alert notification should be enabled.  <br>   &nbsp; 1.d. Alert notification severity should be at least set to 'Medium' such that notification is triggered for both Medium and High severity alert. <br><b>Failed: </b><br> 1. ASC security contact setting does not meet the following conditions: <br>     &nbsp; 1.a. 'Owner' and 'Account Admin' should be selected as email recipients. <br>     &nbsp; 1.b. At least one email id is specified as email recipients. <br>     &nbsp; 1.c. Notify about alerts is enabled. <br>     &nbsp; 1.d. Alert notification severity should be at least set to 'Medium' such that notification is triggered for both Medium and High severity alert. <br> 2. Fail if security center provider is not registered. |
| <b>ControlId:</b><br>Azure_Subscription_AuthZ_Limit_ClassicAdmin_Count<br><b>DisplayName:</b><br>Limit access per subscription to 2 or less classic administrators.<br><b>Description: </b><br>Limit access per subscription to 2 or less classic administrators. | <b>ARM API to list classic role assignment at subscription level: </b> <br>subscriptions/{subscriptionId}/providers<br>/Microsoft.Authorization/classicAdministrators<br>?api-version=2015-06-01<br> <b>Property:</b><br> properties.role | <b>Passed: </b><br>The count of classic administrators does not exceed 2.<br><b>Failed: </b><br>More than 2 classic administrators accounts found. <br> <b> Verify </b> <br> RBAC result not found (sufficient data is not available for evaluation).|
| <b>ControlId:</b><br>Azure_Subscription_AuthZ_Remove_Management_Certs<br><b>DisplayName:</b><br>Do not use management certificates.<br><b>Description: </b><br> Management certificates are classic methods for automation on Azure subscription but are risky because the hygiene tends to be laxed and can easily be compromised.| <b>ARM API to list security assessments at <br>subscription level:</b><br>/subscriptions/{subscriptionId}/providers<br>/Microsoft.Security/assessments<br>?api-version=2020-01-01<br><b>Properties:</b><br>id, name, resourceDetails/Id, displayName, status/code, status, additionalData <br> <b>Azure built-in policy: </b> <br> Service principals should be used to protect your subscriptions instead of management certificates. | <b>Passed: </b><br>ASC assessment status is healthy.<br><b>Failed: </b><br>ASC assessment status is unhealthy. (or) ASC assessment status is "NotApplicable" with "cause" as either "OffByPolicy" or "Exempt". <br> <b>Verify:</b><br>ASC assessment status is not applicable (with "cause" other than "OffByPolicy" and "Exempt"), OR <br> ASC assessment status was not found.|
| <b>ControlId:</b><br>Azure_Subscription_Config_Add_Required_Tags<br><b>DisplayName:</b><br>Mandatory tags must be set per your organization policy.<br><b>Description: </b><br>Mandatory tags must be set per your organization policy. | <b>ARM API to get the entire set of tags on a resource or subscription: </b> </br>/{scope}/providers/Microsoft.Resources/tags/default?<br>api-version=2019-10-01 <br><b>Properties:</b><br>properties.tags <br> </br> <b> ARM API to get resource group tags </b> <br> /subscriptions/{subscriptionId}/resourcegroups?<br>api-version=2019-10-01 <br> <b>Properties:</b> <br> tags| <b>Passed: </b><br>Mandatory tags are present on all the resource group in a subscription and its value is configured correctly, for example Production, Pre-Production e.t.c.<br><b>Failed: </b><br>Mandatory tags are not present on all the resource group in a subscription or its value is not configured correctly, for example Production, Pre-Production e.t.c.|

