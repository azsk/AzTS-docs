| ControlId | Dependent Azure API(s) and Properties | Control Spec-let |
|-----------|-------------------------------------|------------------|
| <b>ControlId:</b><br>Azure_KeyVault_SI_Enable_SoftDelete<br><br><b>DisplayName:</b><br>Soft delete must be enabled to allow recovery of deleted Key Vault and any objects (keys, secrets, etc.) contained in it.<br><br><b>Description: </b><br> Soft delete must be enabled to allow recovery of deleted Key Vault and any objects (keys, secrets, etc.) contained in it. |<b> ARM API to list all the KeyVault configurations under the specified subscription: </b> <br> /subscriptions/{subscriptionId}/providers<br>/Microsoft.KeyVault/vaults<br>?api-version=2019-09-01 <br><br><b>Properties:</b><br> properties/enableSoftDelete|<b>Passed: </b><br>Soft delete is enabled for KeyVault.<br><br><b>Failed: </b><br>Soft delete is disabled for KeyVault. |
| <b>ControlId:</b><br>Azure_KeyVault_AuthZ_Configure_Advanced_Access_Policies<br><br><b>DisplayName:</b><br>Advanced access policies must be configured on a need basis.<br><br><b>Description: </b><br> Advanced access policies must be configured on a need basis. |<b> ARM API to list all the KeyVault configurations under the specified subscription: </b> <br> /subscriptions/{subscriptionId}/providers<br>/Microsoft.KeyVault/vaults<br>?api-version=2019-09-01 <br><br><b>Properties:</b><br> properties/enabledForDeployment<br> properties/enabledForDiskEncryption<br> properties/enabledForTemplateDeployment|<b>Passed: </b><br>All Advanced access policies are not enabled.<br><br><b>Failed: </b><br>All Advanced access policies are enabled. |
| <b>ControlId:</b><br>Azure_KeyVault_Audit_Enable_Diagnostics_Log<br><b>DisplayName:</b><br>Diagnostics logs must be enabled for Key Vault.<br><b>Description: </b><br>Diagnostics logs must be enabled for Key Vault. | <b>ARM API to list diagnostic setting details of Key Vault resources: </b> </br> /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}<br>/providers/Microsoft.KeyVault/vaults/{serviceName}/providers<br>/microsoft.insights/diagnosticSettings?api-version=2017-05-01-preview <br><b>Properties:</b><br> name <br>properties.logs.category <br> properties.logs.enabled <br> properties.logs.retentionPolicy.enabled <br> properties.logs.retentionPolicy.days <br> properties.workspaceId <br> properties.storageAccountId <br> properties.eventHubName <br>|<b>Scope: </b> All Key Vault resources in subscription.<br><br> <b>Config: </b><br> DiagnosticLogs: AuditEvent <br> DiagnosticMinRetentionPeriod : 365  <br> DiagnosticForeverRetentionValue : 0 <br><br> <b>Passed: </b><br>1. Required diagnostic logs are enabled.<br> *and* <br> 2. At least one of the below setting configured:<br> a. Log Analytics. <br> b. Storage account (with min Retention period of 365 or forever(Retention period 0). <br> c. Event Hub. <br><b>Failed: </b><br>1. Diagnostics setting is disabled for resource. <br> *or* <br> 2. Diagnostic setting meet the following conditions: <br> a. All diagnostic logs are not enabled. <br> b. None of the below setting is configured: <br> i. Log Analytics.<br> ii. Storage account (with min Retention period of 365 or forever(Retention period 0).<br> iii. Event Hub. <br> <b>Error</b> <br>Required logs are not configured in control settings.|