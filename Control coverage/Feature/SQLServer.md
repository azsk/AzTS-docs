## SQLServer

| ControlId | Dependent Azure API(s) and Properties | Control spec-let |
|-----------|-------------------------------------|------------------|
| <b>ControlId:</b><br>Azure_SQLDatabase_Audit_Enable_Logging_and_Monitoring_Server<br><b>DisplayName:</b><br>Ensure Azure SQL Server auditing is configured correctly<br><b>Description: </b><br> Enable SQL Server audit with selected event types and retention period of minimum 365 days |<b>ARM API to get Auditing settings of a SQLServer: </b> <br> /subscriptions/{subscriptionId}<br>/resourceGroups/{resourceGroupName}<br>/providers/Microsoft.Sql<br>/servers/{serverName}<br>/auditingSettings/default<br>?api-version=2017-03-01-preview <br><b>Properties:</b><br> properties.AuditSetting.State<br> properties.StorageAccountSubscriptionId <br> properties.StorageEndpoint <br> properties.RetentionDays <br> properties.IsAzureMonitorTargetEnabled | <b>Passed: </b><br>All the following conditions are true - <br> a. Auditing is enabled <br> b. At least one of three types are selected (these include storage account, log analytics or event hub), <br> c. Storage details are defined <br> d. Retention period is set to at least 365 days.<br><b>Failed: </b><br>Any one of the four conditions is false - <br> a. Auditing is enabled <br> b. At least one of three types are selected (these include storage account, log analytics or event hub), <br> c. Storage details are defined <br> d. Retention period is set to at least 365 days. |
| <b>ControlId:</b><br>Azure_SQLDatabase_Audit_Enable_Threat_Detection_Server<br><b>DisplayName:</b><br>Enable advanced data security on your SQL servers<br><b>Description: </b><br> Enable SQL Server threat detection with email admins option. Do not exclude any detection types|<b>ARM API to get Auditing settings of a SQLServer: </b> <br> /subscriptions/{subscriptionId}<br>/resourceGroups/{resourceGroupName}<br>/providers/Microsoft.Sql<br>/servers/{serverName}<br>/auditingSettings/default<br>?api-version=2017-03-01-preview <br><b>Properties:</b><br> properties.State <br> <br> <b>ARM API to get Security Alert policy of a SQLServer: </b> <br> /subscriptions/{subscriptionId}<br>/resourceGroups/{resourceGroupName}<br>/providers/Microsoft.Sql<br>/servers/{serverName}<br>/securityAlertPolicies/default <br>?api-version=2017-03-01-preview<br><b>Properties:</b><br> properties.AuditSetting.State<br> properties.EmailAccountAdmins <br> properties.DisabledAlerts <br> properties.EmailAddresses | <b>Passed: </b><br>All the following conditions are true - <br> a. Auditing is enabled <br> b. Advanced threat protection setting is enabled <br> c. All Advanced Threat Protection types are enabled <br> d. Atleast one option to send email notification on alert is selected.<br><b>Failed: </b><br>Any one of the four conditions is false - <br> a. Auditing is enabled <br>  b. Advanced threat protection setting is enabled <br> c. All Advanced Threat Protection types are enabled <br> d. Atleast one option to send email notification on alert is selected. |
| <b>ControlId:</b><br>Azure_SQLDatabase_Audit_Enable_Vuln_Assessment<br><b>DisplayName:</b><br>Enable Vulnerability assessment on your SQL servers<br><b>Description: </b><br> Enable SQL Server vulnerability assessments with email admins option |<b>ARM API to get Vulnerability Assessment of a SQLServer: </b> <br> /subscriptions/{subscriptionId}<br>/resourceGroups/{resourceGroupName}<br>/providers/Microsoft.Sql<br>/servers/{serverName}<br>/vulnerabilityAssessments/default <br>?api-version=2018-06-01-preview <br><b>Properties:</b><br> properties.VulnerabilityAssessmentSetting.IsEnabled<br> properties.EmailSubscriptionAdmins <br> properties.Emails <br> properties.StorageContainerPath | <b>Passed: </b><br>All the following conditions are true - <br> a. Vulnerability assessment setting is enabled <br> b. Atleast one option to send email notification on alert is selected <br> c. Storage account container path is selected. <br><b>Failed: </b><br>Any one of the three conditions is false - <br> a. Vulnerability assessment setting is enabled <br> b. Atleast one option to send email notification on alert is selected <br> c. Storage account container path is selected. |
| <b>ControlId:</b><br>Azure_SQLDatabase_AuthZ_Firewall_Deny_Access_AzureServices<br><b>DisplayName:</b><br>Use the 'Allow access to Azure services' flag only if required<br><b>Description: </b><br> Use the 'Allow access to Azure services' flag only if required |<b>ARM API to get Firewall rules for SQLServer: </b> <br> /subscriptions/{subscriptionId}<br>/resourceGroups/{resourceGroupName}<br>/providers/Microsoft.Sql<br>/servers/{serverName}<br>/firewallRules <br> ?api-version=2014-04-01 <br><b>Properties:</b><br> properties.FirewallRuleList | <b>Passed: </b><br>Allow access to Azure services flag is on.<br><b>Failed: </b><br>Allow access to Azure services flag is off. |
| <b>ControlId:</b><br>Azure_SQLDatabase_AuthZ_Use_AAD_Admin<br><b>DisplayName:</b><br>Use AAD Authentication for SQL Database<br><b>Description: </b><br> Enable Azure AD admin for the SQL Database |<b>ARM API to get Administrators of SQLServer: </b> <br> /subscriptions/{subscriptionId}<br>/resourceGroups/{resourceGroupName}<br>/providers/Microsoft.Sql<br>/servers/{serverName}<br>/administrators<br>?api-version=2014-04-01 <br><b>Properties:</b><br> properties.IsADAdministratorEnabled | <b>Passed: </b><br>Active Directory admins are assigned on SQL Server.<br><b>Failed: </b><br>No Active Directory admin is assigned on SQL Server. |
| <b>ControlId:</b><br>Azure_SQLDatabase_DP_Enable_TDE<br><b>DisplayName:</b><br>Transparent data encryption (TDE) must be enabled<br><b>Description:</b><br>Transparent data encryption (TDE) must be enabled |<b>ARM API to get Databases of SQLServer:</b><br>/subscriptions/{subscriptionId}<br>/resourceGroups/{resourceGroupName}<br>/providers/Microsoft.Sql<br>/servers?api-version=2019-06-01-preview<br><b>Properties:</b><br>properties.Databases<br> Databases.TDEStatus<br><b>Azure built-in policy: </b>Transparent Data Encryption on SQL databases should be enabled. | <b>Passed:</b><br>ASC assessment status is healthy. All databases for SQL server have transparent data encryption enabled, or <br>No database is present for SQL server.<br><b>Failed:</b><br>ASC assessment status is unhealthy. At least one of the databases for SQL server do not have transparent data encryption enabled. <br>(or)<br> ASC assessment status is "NotApplicable" with "cause" as either "OffByPolicy" or "Exempt".<br><b>Verify:</b> <br>ASC assessment status is not applicable (with "cause" other than "OffByPolicy" and "Exempt").<br><b>Note:</b> If ASC Assessment is not found for a resource, the ARM API is used for the evaluation. |
| <b>ControlId:</b><br>Azure_SQLDatabase_NetSec_Dont_Allow_Universal_IP_Range<br><b>DisplayName:</b><br>Do not use Any-to-Any IP range for Azure SQL Database<br><b>Description: </b><br> Do not use Any-to-Any IP range for Azure SQL Database |<b>ARM API to get Firewall rules for SQLServer: </b> <br> /subscriptions/{subscriptionId}<br>/resourceGroups/{resourceGroupName}<br>/providers/Microsoft.Sql<br>/servers/{serverName}<br>/firewallRules<br>?api-version=2014-04-01 <br><b>Properties:</b><br> properties.FirewallRuleList | <b>Passed: </b><br>Traffic from services within your Azure subscription, or <br>No additional firewall rule, or<br>Custom firewall rule without Any-to-Any IP range.<br><b>Failed: </b><br>Custom firewall rule with Any-to-Any IP range with Start IP address as 0.0.0.0 and End Ip address as 255.255.255.255. is found. |
