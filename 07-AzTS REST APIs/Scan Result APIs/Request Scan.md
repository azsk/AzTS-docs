
> The Azure Tenant Security Solution (AzTS) was created by the Core Services Engineering & Operations (CSEO) division at Microsoft, to help accelerate Microsoft IT's adoption of Azure. We have shared AzTS and its documentation with the community to provide guidance for rapidly scanning, deploying and operationalizing cloud resources, across the different stages of DevOps, while maintaining controls on security and governance.
<br>AzTS is not an official Microsoft product â€“ rather an attempt to share Microsoft CSEO's best practices with the community..

<br>

## **Request scan - POST**

Request ad-hoc scan for subscription(s).

**Description**
<br/>
In order to scan a subscription(s), you need to provide list of subscription id(s). This API will queue subscription(s) for scan by AzTS and will return status of scan request for all subscriptions along with 'Scan Request Id'. This 'Scan Request Id' can be further used to [get scan results](./Scan%20Result%20APIs/Get%20Scan%20Results.md#get-scan-results---post).


**Permissions**

You must have permission over subscription or resource group in the subscription with any of the following roles:
- Owner
- Contributor
- ServiceAdministrator
- CoAdministrator
- AccountAdministrator
- Security Reader
- Security Admin
> **Note:** If you have been recently granted access to a subscription, you would be access AzTS APIs after 24 hours as it takes 24 hours to refresh latest RBAC.

**Request URL**

``` PowerShell
POST https://<WebAPI-URL>/adhocscan/RequestScan?api-version=1.0
```
> _Note:_<br/>
>_1. 'WebAPI-URL' varies per AzTS setup. You need to reach out to AzTS admin to get value for `<WebAPI-URL`> as mentioned [here](../README.md#setup-for-azts-admin-only)._<br/>
>_2. 'api-version' is an optional parameter. Current and default supported version: **1.0**_

<br/>

**Request Header**
|Param Name|Description|Required?
|----|----|----|
| Authorization| Bearer Token which can be generated by following steps [here](../Authentication%20flow%20for%20AzTS%20REST%20APIs.md#authentication-flow-for-azts-rest-apis) | Yes|


**Request Body**

|Param Name|Type| Description|Required?
|----|----|----|----|
| SubscriptionIDList|List`<string`>| List of subscription id(s) for scan.| Yes|


## **Example** 
<br/>

**Sample Request**
``` 
 POST https://AzSK-AzTS-WebApi-xxxxx/adhocscan/RequestScan?api-version=1.0
```
<br/> 

**Sample Request Body**

```JSON
{
    "SubscriptionIDList": [
        "48f73dab-a34c-49a5-b5f5-db1285d422c7",
        "1c38e61e-b8ec-4db5-a98d-43d4662958b9"
    ]
}
```
**Sample Response**
``` JSON
[
    {
        "subscriptionID": "48f73dab-a34c-49a5-b5f5-db1285d422c7",
        "jobID": "20210914014045",
        "queueStatus": "Processing",
        "message": "Subscription added to the queue",
        "timeSpan": "9/14/2021 1:40:45 PM",
        "scanRequestId": "20210914014045"
    },
    {
        "subscriptionID": "1c38e61e-b8ec-4db5-a98d-43d4662958b9",
        "jobID": "20210914014045",
        "queueStatus": "Processing",
        "message": "Subscription added to the queue",
        "timeSpan": "9/14/2021 1:40:45 PM",
        "scanRequestId": "20210914014045"
    }
]
```
> **Note:** 
> </br>
> 1. On demand scan for each subcription can be requested maximum 10 times in a day.
> 2. Use **scanRequestId** to get latest scan results.
